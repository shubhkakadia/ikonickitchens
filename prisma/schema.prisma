generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model users {
  id                  String               @id @default(uuid())
  username            String               @unique
  password            String
  user_type           String
  is_active           Boolean              @default(true)
  employee_id         String?              @unique
  // module_access       String?              @db.LongText
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  logs                logs[]
  material_selection  material_selection[]
  materials_to_orders materials_to_order[] @relation("MaterialsToBeOrderedCreatedBy")
  purchase_order      purchase_order[]     @relation("PurchaseOrderOrderedBy")
  sessions            sessions[]
  employee            employees?           @relation(fields: [employee_id], references: [employee_id])
  module_access       module_access?

  @@index([employee_id])
}

model module_access {
  id               String   @id @default(uuid())
  user_id          String   @unique
  all_clients      Boolean  @default(false)
  add_clients      Boolean  @default(false)
  client_details   Boolean  @default(false)
  dashboard        Boolean  @default(false)
  delete_media     Boolean  @default(false)
  all_employees    Boolean  @default(false)
  add_employees    Boolean  @default(false)
  employee_details Boolean  @default(false)
  all_projects     Boolean  @default(false)
  add_projects     Boolean  @default(false)
  project_details  Boolean  @default(false)
  all_suppliers    Boolean  @default(false)
  add_suppliers    Boolean  @default(false)
  supplier_details Boolean  @default(false)
  all_items        Boolean  @default(false)
  add_items        Boolean  @default(false)
  item_details     Boolean  @default(false)
  usedmaterial     Boolean  @default(false)
  logs             Boolean  @default(false)
  lotatglance      Boolean  @default(false)
  materialstoorder Boolean  @default(false)
  purchaseorder    Boolean  @default(false)
  statements       Boolean  @default(false)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  user             users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
}

model sessions {
  id         String   @id @default(uuid())
  user_id    String
  token      String   @unique
  user_type  String
  expires_at DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([user_type])
  @@index([expires_at])
}

model employees {
  id                      String           @id @default(uuid())
  createdAt               DateTime         @default(now())
  updatedAt               DateTime         @updatedAt
  employee_id             String           @unique
  first_name              String
  last_name               String?
  image_id                String?          @unique
  role                    String
  email                   String           @unique
  phone                   String
  dob                     DateTime?
  join_date               DateTime?
  address                 String?          @db.LongText
  emergency_contact_name  String?
  emergency_contact_phone String?
  bank_account_name       String?
  bank_account_number     String?
  bank_account_bsb        String?
  supper_account_name     String?
  supper_account_number   String?
  tfn_number              String?
  education               String?
  availability            String?          @db.LongText
  notes                   String?
  abn_number              String?
  image                   media?           @relation(fields: [image_id], references: [id], onDelete: Cascade)
  stages                  stage_employee[]
  user                    users?

  @@index([employee_id])
}

model media {
  id                   String              @id @default(uuid())
  url                  String
  filename             String?
  file_type            String?
  mime_type            String?
  extension            String?
  size                 Int?
  is_deleted           Boolean             @default(false)
  employee_id          String?
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  materials_to_orderId String?
  item_id              String?
  employee             employees?
  item                 item?
  materials_to_order   materials_to_order? @relation(fields: [materials_to_orderId], references: [id], onDelete: Cascade)

  @@index([employee_id])
  @@index([materials_to_orderId], map: "media_materials_to_orderId_fkey")
}

model contact {
  id                       String    @id @default(uuid())
  createdAt                DateTime  @default(now())
  updatedAt                DateTime  @updatedAt
  client_id                String?
  supplier_id              String?
  first_name               String
  last_name                String?
  email                    String?
  phone                    String?
  preferred_contact_method String?
  notes                    String?   @db.LongText
  role                     String?
  client                   client?   @relation(fields: [client_id], references: [client_id], onDelete: Cascade)
  supplier                 supplier? @relation(fields: [supplier_id], references: [supplier_id], onDelete: Cascade)

  @@index([client_id], map: "contact_client_id_fkey")
  @@index([supplier_id], map: "contact_supplier_id_fkey")
}

model client {
  client_id      String    @id @default(uuid())
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  client_type    String
  client_name    String    @unique
  client_address String?   @db.LongText
  client_phone   String?
  client_email   String?
  client_website String?
  client_notes   String?   @db.LongText
  contacts       contact[]
  projects       project[]

  @@index([client_name])
  @@index([client_id])
}

model project {
  id                 String               @id @default(uuid())
  name               String
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  project_id         String               @unique
  client_id          String?
  lots               lot[]
  material_selection material_selection[]
  materials_to_order materials_to_order[]
  client             client?              @relation(fields: [client_id], references: [client_id], onDelete: Cascade)

  @@index([project_id])
  @@index([client_id], map: "project_client_id_fkey")
}

model lot {
  id                     String              @id @default(uuid())
  createdAt              DateTime            @default(now())
  updatedAt              DateTime            @updatedAt
  lot_id                 String              @unique
  project_id             String
  name                   String
  status                 LotStatus           @default(ACTIVE)
  startDate              DateTime?
  installationDueDate    DateTime?
  notes                  String?             @db.LongText
  materials_to_orders_id String?
  material_selection_id  String?             @unique
  materials_to_orders    materials_to_order? @relation(fields: [materials_to_orders_id], references: [id])
  project                project             @relation(fields: [project_id], references: [project_id], onDelete: Cascade)
  tabs                   lot_tab[]
  material_selection     material_selection?
  stages                 stage[]

  @@index([lot_id])
  @@index([project_id])
  @@index([materials_to_orders_id], map: "lot_materials_to_orders_id_fkey")
}

model stage {
  stage_id    String           @id @default(uuid())
  lot_id      String
  name        String
  status      StageStatus
  notes       String?          @db.LongText
  startDate   DateTime?
  endDate     DateTime?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  lot         lot              @relation(fields: [lot_id], references: [lot_id], onDelete: Cascade)
  assigned_to stage_employee[]

  @@index([stage_id])
  @@index([lot_id])
  @@index([name])
  @@index([status])
}

model stage_employee {
  id          String    @id @default(uuid())
  stage_id    String
  employee_id String
  assigned_at DateTime  @default(now())
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  employee    employees @relation(fields: [employee_id], references: [employee_id])
  stage       stage     @relation(fields: [stage_id], references: [stage_id], onDelete: Cascade)

  @@unique([stage_id, employee_id])
  @@index([stage_id])
  @@index([employee_id])
}

model lot_tab {
  id        String     @id @default(uuid())
  lot_id    String
  tab       TabKind
  notes     String?    @db.LongText
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  files     lot_file[]
  lot       lot        @relation(fields: [lot_id], references: [lot_id], onDelete: Cascade)

  @@unique([lot_id, tab])
  @@index([lot_id, tab])
}

model lot_file {
  id         String            @id @default(uuid())
  tab_id     String
  file_kind  FileKind          @default(PHOTO)
  url        String
  filename   String
  mime_type  String?
  extension  String?
  size       Int?
  site_group SiteMeasurements?
  is_deleted Boolean           @default(false)
  notes      String?           @db.LongText
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt
  tab        lot_tab           @relation(fields: [tab_id], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([tab_id])
  @@index([file_kind])
  @@index([site_group])
  @@index([is_deleted])
}

model quote {
  id                        String                        @id @default(uuid())
  quote_id                  String                        @unique
  createdAt                 DateTime                      @default(now())
  updatedAt                 DateTime                      @updatedAt
  materialSelections        material_selection[]
  materialSelectionVersions material_selection_versions[]

  @@index([quote_id])
}

model material_selection {
  id                 String                        @id @default(uuid())
  project_id         String?
  quote_id           String?
  createdBy_id       String?
  createdAt          DateTime                      @default(now())
  current_version_id String?                       @unique
  lot_id             String                        @unique
  updatedAt          DateTime                      @updatedAt
  createdBy          users?                        @relation(fields: [createdBy_id], references: [id])
  currentVersion     material_selection_versions?  @relation("CurrentVersion", fields: [current_version_id], references: [id])
  lot                lot                           @relation(fields: [lot_id], references: [lot_id], onDelete: Cascade)
  project            project?                      @relation(fields: [project_id], references: [project_id], onDelete: Cascade)
  quote              quote?                        @relation(fields: [quote_id], references: [quote_id], onDelete: Cascade)
  versions           material_selection_versions[] @relation("AllVersions")

  @@index([project_id])
  @@index([id])
  @@index([createdBy_id], map: "material_selection_createdBy_id_fkey")
  @@index([quote_id], map: "material_selection_quote_id_fkey")
}

model material_selection_versions {
  id                    String                            @id @default(uuid())
  material_selection_id String
  version_number        Int                               @default(1)
  is_current            Boolean                           @default(false)
  quote_id              String?
  ceiling_height        Decimal?                          @db.Decimal(10, 2)
  bulkhead_height       Decimal?                          @db.Decimal(10, 2)
  kicker_height         Decimal?                          @db.Decimal(10, 2)
  cabinetry_height      Decimal?                          @db.Decimal(10, 2)
  notes                 String?                           @db.LongText
  createdAt             DateTime                          @default(now())
  updatedAt             DateTime                          @updatedAt
  currentFor            material_selection?               @relation("CurrentVersion")
  areas                 material_selection_version_area[]
  material_selection    material_selection                @relation("AllVersions", fields: [material_selection_id], references: [id], onDelete: Cascade)
  quote                 quote?                            @relation(fields: [quote_id], references: [quote_id], onDelete: Cascade)

  @@unique([material_selection_id, version_number])
  @@index([createdAt])
  @@index([material_selection_id])
  @@index([quote_id])
}

model material_selection_version_area {
  id               String                                 @id @default(uuid())
  version_id       String
  area_name        String
  area_instance_id Int                                    @default(1)
  bed_option       String?
  notes            String?                                @db.LongText
  createdAt        DateTime                               @default(now())
  updatedAt        DateTime                               @updatedAt
  version          material_selection_versions            @relation(fields: [version_id], references: [id], onDelete: Cascade)
  items            material_selection_version_area_item[]

  @@index([id])
  @@index([version_id], map: "material_selection_version_area_version_id_fkey")
}

model material_selection_version_area_item {
  id              String                          @id @default(uuid())
  version_area_id String
  name            String
  category        String?
  is_applicable   Boolean                         @default(false)
  item_notes      String?                         @db.LongText
  createdAt       DateTime                        @default(now())
  updatedAt       DateTime                        @updatedAt
  version_area    material_selection_version_area @relation(fields: [version_area_id], references: [id], onDelete: Cascade)

  @@index([id])
  @@index([version_area_id], map: "material_selection_version_area_item_version_area_id_fkey")
}

model item {
  item_id                  String                    @id @default(uuid())
  category                 Category
  description              String?
  price                    Decimal?                  @db.Decimal(10, 2)
  quantity                 Int?                      @default(0)
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  measurement_unit         String?
  supplier_id              String?
  image_id                 String?                   @unique
  supplier_product_link    String?                   @db.LongText
  supplier_reference       String?
  accessory                accessory?
  edging_tape              edging_tape?
  handle                   handle?
  hardware                 hardware?
  image                    media?                    @relation(fields: [image_id], references: [id], onDelete: Cascade)
  supplier                 supplier?                 @relation(fields: [supplier_id], references: [supplier_id], onDelete: Cascade)
  materials_to_order_items materials_to_order_item[]
  purchase_order_item      purchase_order_item[]
  sheet                    sheet?
  stock_transactions       stock_transaction[]

  @@unique([item_id, category])
  @@index([category])
  @@index([supplier_id], map: "item_supplier_id_fkey")
}

model sheet {
  item_id    String   @id @unique
  brand      String?
  color      String?
  finish     String?
  face       String?
  dimensions String
  is_sunmica Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  item       item     @relation(fields: [item_id], references: [item_id], onDelete: Cascade)
}

model handle {
  item_id    String   @id @unique
  brand      String?
  color      String?
  type       String?
  dimensions String?
  material   String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  item       item     @relation(fields: [item_id], references: [item_id], onDelete: Cascade)
}

model hardware {
  item_id      String   @id @unique
  brand        String?
  name         String?
  type         String?
  dimensions   String?
  sub_category String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  item         item     @relation(fields: [item_id], references: [item_id], onDelete: Cascade)
}

model accessory {
  item_id   String   @id @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  item      item     @relation(fields: [item_id], references: [item_id], onDelete: Cascade)
}

model edging_tape {
  item_id    String   @id @unique
  brand      String?
  color      String?
  finish     String?
  dimensions String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  item       item     @relation(fields: [item_id], references: [item_id], onDelete: Cascade)
}

model supplier {
  supplier_id    String               @id @default(uuid())
  name           String               @unique
  address        String?              @db.LongText
  phone          String?
  email          String?
  website        String?
  notes          String?              @db.LongText
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  abn_number     String?
  contacts       contact[]
  items          item[]
  purchase_order purchase_order[]
  statements     supplier_statement[]

  @@index([supplier_id])
}

model supplier_statement {
  id               String        @id @default(uuid())
  month_year       String
  notes            String?       @db.LongText
  payment_status   PaymentStatus @default(PENDING)
  amount           Decimal?      @db.Decimal(10, 2)
  due_date         DateTime
  supplier_file_id String
  supplier_id      String
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  supplier_file    supplier_file @relation(fields: [supplier_file_id], references: [id], onDelete: Cascade)
  supplier         supplier      @relation(fields: [supplier_id], references: [supplier_id], onDelete: Cascade)

  @@index([supplier_file_id])
  @@index([supplier_id], map: "supplier_statement_supplier_id_fkey")
}

model supplier_file {
  id                 String               @id @default(uuid())
  url                String
  filename           String
  file_type          String
  mime_type          String?
  extension          String?
  size               Int?
  is_deleted         Boolean              @default(false)
  supplier_id        String
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  purchase_order     purchase_order?
  supplier_statement supplier_statement[]
}

model materials_to_order {
  id                 String                    @id @default(uuid())
  project_id         String?
  status             MTOStatus                 @default(DRAFT)
  notes              String?                   @db.LongText
  createdBy_id       String?
  createdAt          DateTime                  @default(now())
  updatedAt          DateTime                  @updatedAt
  media_id           String?
  lots               lot[]
  createdBy          users?                    @relation("MaterialsToBeOrderedCreatedBy", fields: [createdBy_id], references: [id])
  project            project?                  @relation(fields: [project_id], references: [project_id], onDelete: Cascade)
  items              materials_to_order_item[]
  media              media[]
  purchase_order     purchase_order[]
  stock_transactions stock_transaction[]

  @@index([project_id])
  @@index([status])
  @@index([createdBy_id], map: "materials_to_order_createdBy_id_fkey")
}

model materials_to_order_item {
  id               String                @id @default(uuid())
  mto_id           String
  item_id          String
  quantity         Int
  notes            String?               @db.LongText
  quantity_ordered Int                   @default(0)
  quantity_used    Int                   @default(0)
  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @updatedAt
  item             item                  @relation(fields: [item_id], references: [item_id], onDelete: Cascade)
  mto              materials_to_order    @relation(fields: [mto_id], references: [id], onDelete: Cascade)
  ordered_items    purchase_order_item[]

  @@index([mto_id])
  @@index([item_id])
}

model purchase_order {
  id                 String                @id @default(uuid())
  order_no           String                @unique
  supplier_id        String
  mto_id             String?
  ordered_at         DateTime?
  orderedBy_id       String?
  invoice_url_id     String?               @unique
  total_amount       Decimal?              @db.Decimal(10, 2)
  notes              String?               @db.LongText
  status             PurchaseOrderStatus   @default(DRAFT)
  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt
  invoice_url        supplier_file?        @relation(fields: [invoice_url_id], references: [id], onDelete: Cascade)
  mto                materials_to_order?   @relation(fields: [mto_id], references: [id])
  orderedBy          users?                @relation("PurchaseOrderOrderedBy", fields: [orderedBy_id], references: [id])
  supplier           supplier              @relation(fields: [supplier_id], references: [supplier_id])
  items              purchase_order_item[]
  stock_transactions stock_transaction[]

  @@index([mto_id], map: "purchase_order_mto_id_fkey")
  @@index([orderedBy_id], map: "purchase_order_orderedBy_id_fkey")
  @@index([supplier_id], map: "purchase_order_supplier_id_fkey")
}

model purchase_order_item {
  id                String                   @id @default(uuid())
  order_id          String
  item_id           String
  mto_item_id       String?
  quantity          Int
  quantity_received Int?                     @default(0)
  unit_price        Decimal?                 @db.Decimal(10, 2)
  notes             String?                  @db.LongText
  createdAt         DateTime                 @default(now())
  updatedAt         DateTime                 @updatedAt
  item              item                     @relation(fields: [item_id], references: [item_id])
  mto_item          materials_to_order_item? @relation(fields: [mto_item_id], references: [id])
  order             purchase_order           @relation(fields: [order_id], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([item_id], map: "purchase_order_item_item_id_fkey")
  @@index([mto_item_id], map: "purchase_order_item_mto_item_id_fkey")
  @@index([order_id], map: "purchase_order_item_order_id_fkey")
}

model stock_transaction {
  id                    String               @id @default(uuid())
  item_id               String
  quantity              Int
  type                  StockTransactionType
  notes                 String?              @db.LongText
  materials_to_order_id String?
  purchase_order_id     String?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime             @updatedAt
  item                  item                 @relation(fields: [item_id], references: [item_id], onDelete: Cascade)
  materials_to_order    materials_to_order?  @relation(fields: [materials_to_order_id], references: [id])
  purchase_order        purchase_order?      @relation(fields: [purchase_order_id], references: [id])

  @@index([createdAt])
  @@index([item_id])
  @@index([purchase_order_id])
  @@index([materials_to_order_id])
}

model logs {
  id          String    @id @default(uuid())
  user_id     String?
  entity_type String
  entity_id   String
  action      LogAction
  description String?
  createdAt   DateTime  @default(now())
  user        users?    @relation(fields: [user_id], references: [id])

  @@index([createdAt])
  @@index([user_id])
  @@index([entity_type])
  @@index([entity_id])
  @@index([action])
}

enum LogAction {
  CREATE
  UPDATE
  DELETE
  STATUS_CHANGE
  ASSIGN
  UPLOAD
  OTHER
}

enum StageStatus {
  NOT_STARTED
  IN_PROGRESS
  DONE
  NA
}

enum LotStatus {
  ACTIVE
  COMPLETED
}

enum TabKind {
  ARCHITECTURE_DRAWINGS
  APPLIANCES_SPECIFICATIONS
  MATERIAL_SELECTION
  CABINETRY_DRAWINGS
  CHANGES_TO_DO
  SITE_MEASUREMENTS
}

enum FileKind {
  PHOTO
  VIDEO
  PDF
  OTHER
}

enum SiteMeasurements {
  SITE_PHOTOS
  MEASUREMENT_PHOTOS
}

enum Category {
  SHEET
  HANDLE
  HARDWARE
  ACCESSORY
  EDGING_TAPE
}

enum PaymentStatus {
  PENDING
  PAID
}

enum MTOStatus {
  DRAFT
  PARTIALLY_ORDERED
  FULLY_ORDERED
  CLOSED
}

enum PurchaseOrderStatus {
  DRAFT
  ORDERED
  PARTIALLY_RECEIVED
  FULLY_RECEIVED
  CANCELLED
}

enum StockTransactionType {
  ADDED
  USED
  WASTED
}
